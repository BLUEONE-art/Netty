# 2020.12.31记录

## Netty介绍

1. Netty 是由 JBOSS 提供的一个开源的 Java 框架。
2. Netty 是一个 **异步的**、基于 **事件驱动**的网络应用框架，用以快速开发高性能、高可靠性的网络 IO 程序。

  注：

+ 事件驱动比如网页上有一个按钮，可以触发一个事件，比如点击事件，这个事件会驱动/调用一个函数。
+ 异步是相对于同步而言，同步相当于浏览器发送一个请求给服务器，必须等待响应，收到响应之后才能去做其他操作；而异步不一定要等到响应回来才去做其他操作，会指定一个回调函数来处理回复的响应。

3. Netty 主要针对在 TCP 协议下，面向 Client 端的高效并发应用，或者 Peer-to-Peer 场景下的大量数据持续传输的应用。其网络框架如下：

![](Netty学习笔记.assets/Netty网络框架.png)

4. Netty 本质是一个 NIO 框架，适用于服务器通讯相关的多种应用场景。

## 应用场景

1. 分布式系统中，各个节点之间需要远程服务调用，高性能的 RPC 框架必不可少，Netty 作为基础的通信组件被这些 RPC 框架使用。
2. 阿里分布式服务框架、Dubbo 的 RPC 框架使用 Dubbo 协议进行节点间通信，而 Netty 作为基础的通信组件，实现各个节点之间的内部通信。

# 2021.1.1记录

## I/O 模型基本说明

### 简单理解

就是用什么样的通道进行数据的发送和接收，很大程度上决定了程序通信的性能。

### Java 支持的三种网络编程模型 I/O 模式

1. Java BIO：同步并阻塞(传统阻塞型)，服务器实现模式为一个连接连接一个线程，即客户端有连接请求时服务端就需要启动一个线程进行处理，如果这个连接不做任何事情就会造成不必要的线程开销。

![](C:\Users\dell\Desktop\GithubProject\Netty\学习笔记\Netty学习笔记.assets\BIO模式.png)

缺点：

+ 如果服务器非常多的话，会存在很多很多的线程，线程会占据 CPU 资源，应对高并发的情况会有瓶颈；
+ 并不是所有线程都时时刻刻在通信，会存在线程没有进行通信却占据资源的情况；
+ 线程会阻塞。

2. Java NIO：同步非阻塞，服务器实现模式为一个线程处理多个请求(也可以说处理多个连接、多个服务端)，即客户端发送的请求都会注册到一个多路复用器上，多路复用器轮询到连接有 I/O 请求就进行处理。

![](C:\Users\dell\Desktop\GithubProject\Netty\学习笔记\Netty学习笔记.assets\NIO模式.png)

3. Java AIO(NIO.2)：异步非阻塞，AIO 引入异步通道的概念，采用 Proactor 模式，简化了程序编写，有效的请求才启动线程。其特点是先由操作系统完成后才通知服务端程序启动线程去处理，一般适用于连接数较多并且连接时间较长的应用。

### BIO、NIO、AIO的使用场景

+ BIO 适用于连接数目较小并且固定的架构，这种方式对服务器资源要求比较高，并发局限于应用中，JDK1.4 之前的唯一选择。
+ NIO 适用于==连接数目多并且连接比较短(轻操作)的架构==，比如说聊天服务器，弹幕系统，服务器间通信等。编程比较复杂。
+ AIO 适用于连接数较多并且连接时间较长(重操作)的应用。比如相册服务器，充分调用 OS 参与并发操作，编程比较复杂，KDK7 开始支持。

### Java BIO 基本介绍

+ 传统的 Java IO 编程，相关的类和接口在 java.io
+ BIO(Blocking I/O)：同步阻塞，服务器实现模式为一个连接连接一个线程，即客户端有连接请求时服务端就需要启动一个线程进行处理，如果这个连接不做任何事情就会造成不必要的线程开销。==可以通过线程池机制==进行改善(实现多个客户连接服务器，==并不能减少线程数==)。

+ 适用于连接数目较小并且固定的架构，这种方式对服务器资源要求比较高，并发局限于应用中，JDK1.4 之前的唯一选择。

#### BIO 编程简单流程

+ 服务器端启动一个 ServerSocket
+ 客户端启动 Socket 对服务器进行通信，默认情况下服务器端需要对每个请求(客户)建立一个线程与之通讯
+ 客户端发出请求后，先咨询服务器是否有线程响应，如果没有则会等待或者被拒绝
+ 如果有响应，客户端的线程会等待请求结束后，再继续执行

#### telnet的安装

在连接远程客户端或者测试网络时，我们在Windows上常用到Telnet连接工具，这个Telnet在Windows上是默认没有安装的。

控制面板 --->  以小图标的方式排列 ---> 程序和功能 ---> 启用或关闭 Window 应用中开启 telnet 应用

![](C:\Users\dell\Desktop\GithubProject\NettyStudy\学习笔记\Netty学习笔记.assets\telnet安装.png)

连接：

```java
telnet 127.0.0.1 6666
```

传输字符串

```java
ctrl + ]
send + 发送的字符串
```

#### Java BIO 问题分析

+ 每一个请求都需要创建独立的线程，与对应的客户端进行数据 Read、业务处理和数据 Write。
+ 当并发数较大时，需要创建大量的线程来处理数据，系统资源占用大。
+ 连接建立后，如果当前线程暂时没有数据可读，则线程会阻塞在 Read 操作上，造成线程资源浪费。